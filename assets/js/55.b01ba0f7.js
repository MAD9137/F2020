(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{479:function(e,t,s){"use strict";s.r(t);var a=s(53),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"timer-loops-and-cadisplaylink-loops"}},[e._v("Timer Loops and CADisplayLink Loops")]),e._v(" "),s("p",[e._v("In iOS development, it is possible to execute code in a repeating loop with a specific amount of time between executions using a timer.  There are two different types of timers that you can use: the Timer and the CADisplayLink class.  They work the same way, letting you execute a selector function on a set interval for which you specify the length of the delay.  These repeating timers will continuously run, executing the code until you tell them to stop.")]),e._v(" "),s("p",[e._v("They can be used to perform tasks that need continuous updating, like doing routine server calls, keeping precise time, reading from an input like an accelerometer, or running custom animations.  If your application does require a looping timer, you must first decide which one you should use.")]),e._v(" "),s("h2",{attrs:{id:"using-a-repeating-timer-loop"}},[e._v("Using a Repeating Timer Loop")]),e._v(" "),s("p",[e._v("The "),s("strong",[e._v("Timer")]),e._v(' class offers the most flexibility with a specifiable double floating point time interval that has a "sub-millisecond precision over a range of 10,000 years" (from Apple\'s Swift documentation on TimeInterval).  It also lets you schedule the timer to start on a given date in the future, as seen in the previous lesson.  To use a Timer in your project, you will need to start by creating an optional Timer object in your codeâ€”usually in the main scope of your class.')]),e._v(" "),s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create an optional Timer object")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" myTimer "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("Timer")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("This object will need to be initialized and scheduled to run in the current thread.  When you use any of the Timer initializers, you need to then manually add it to the current run-loop.  In this example, we will see how to combine these two items in one by using a function called "),s("code",[e._v("scheduledTimer()")]),e._v(" within the base Timer class which creates, and adds, the timer object to the current run-loop automatically.  The function used in this example looks like this:")]),e._v(" "),s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create a timer object, set the length of interval between calls to the selector function, and set the timer to loop")]),e._v("\ntimer "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("Timer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("scheduledTimer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("timeInterval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.005")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("self")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" selector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" #"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("timerCallBack"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" userInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" repeats"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("After initializing it, you can start your Timer object's execution by telling it to fire, like so:")]),e._v(" "),s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Tell the timer to start")]),e._v("\ntimer"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("fire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v("Initializing and starting the Timer object is usually done at the same time "),s("em",[e._v("only if")]),e._v(" the timer is equal to nil to avoid starting multiple timers.")])]),e._v(" "),s("p",[e._v("Whenever you decide to stop the timer from running, you invalidate it and you should always set the timer object equal to nil to delete it when you are done with it.")]),e._v(" "),s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Stop the timer from running and delete the object")]),e._v("\ntimer"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("invalidate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\ntimer "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("nil")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("The "),s("strong",[e._v("selector")]),e._v(" method is a function that you create, and decide what code to execute each time the timer repeats.  In the example in this lesson, it is called "),s("code",[e._v("timerCallBack")]),e._v(", but the name is your choice.  The basic structure for a selector method is:")]),e._v(" "),s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token atrule"}},[e._v("@objc")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("func")]),e._v(" timerCallBack "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The timer repeats the execution of your code written here")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("This function can be used to increment a value, display the next frame of an animation, make a url request, or check the state of the devices accelerometer.")]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v("When the timer is started the selector method is executed, then the timer waits for the time interval to elapse before executing the selector method the second time.")])]),e._v(" "),s("h2",{attrs:{id:"using-the-cadisplaylink-class-to-loop"}},[e._v("Using the CADisplayLink Class to Loop")]),e._v(" "),s("p",[e._v("The "),s("strong",[e._v("CADisplayLink")]),e._v(" class, as mentioned before, works the same as the Timer object for repeating the execution of some code.  There are a few differences to keep in mind when choosing which class to use in your project.")]),e._v(" "),s("p",[e._v("The first major difference is that the CADisplayLink is specifically created to run code in a loop, where as the Timer class lets you choose whether or not the timer repeats or executes only a single time.")]),e._v(" "),s("p",[e._v("The next difference is that the CADisplayLink is locked directly to the refresh rate of the screen on the device.  This means you must set the interval time as a preferred frames-per-second.  This is quite different to the Timer, which lets you define the amount of time between executions in seconds (and milliseconds).  This requires a bit of math if you would like to tell the CADisplayLink object to have a specific amount of seconds between executions.")]),e._v(" "),s("p",[e._v("Other than those differences, these two classes work in the same way.")]),e._v(" "),s("p",[e._v("To create a CADisplayLink you would write:")]),e._v(" "),s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create an optional CADisplayLink object")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" cadlTimer "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("CADisplayLink")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("Then you initialize, and set the length of time between executions like so:")]),e._v(" "),s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create a timer object that will call our function cadlTimerCallBack")]),e._v("\ncadlTimer "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("CADisplayLink")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("self")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" selector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" #"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("cadlTimerCallBack"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Set how often this timer should run the callback function")]),e._v("\ncadlTimer"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("preferredFramesPerSecond "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("60")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[e._v("You can then start the timer by adding it to the current run-loop:")]),e._v(" "),s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Tell the timer to start")]),e._v("\ncadlTimer"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("current"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" forMode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("defaultRunLoopMode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("When you wan to stop the loop from running you do the same process as with the Timer object, you invalidate the object and then set it equal to nil to delete it.  In this example this code would look like this:")]),e._v(" "),s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Stop the timer from running and delete the object")]),e._v("\ncadlTimer"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("invalidate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\ncadlTimer "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("nil")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("Again, the selector method is a function that you create, and decide what code to execute each time the timer repeats.  In the example in this lesson it is called "),s("code",[e._v("cadlTimerCallBack")]),e._v(", but again the name is your choice.  The basic structure for this selector method would be:")]),e._v(" "),s("div",{staticClass:"language-swift line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token atrule"}},[e._v("@objc")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("func")]),e._v(" cadlTimerCallBack "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The timer repeats the execution of your code written here")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("As mentioned above, this function is where you would increment a value, display the next frame of an animation, make a url request, or check the state of the device's accelerometer.")]),e._v(" "),s("p",[e._v("The major difference between the two timers is the performance.  The CADisplayLink timer will fire with extremely precise regularity making any visual updates execute as smoothly as possible.  The Timer object runs in the main thread and will seem to be less consistent whenever there is a lot being processed.")]),e._v(" "),s("p",[s("RouterLink",{attrs:{to:"/modules/week12/#during-class"}},[e._v("Back to Week 12")])],1)])}),[],!1,null,null,null);t.default=n.exports}}]);