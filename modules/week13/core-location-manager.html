<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using Core Location Manager | MAD9137-F2020</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="iOS App Development">
    <link rel="preload" href="/F2020/assets/css/0.styles.a9e3dc67.css" as="style"><link rel="preload" href="/F2020/assets/js/app.255cbd1a.js" as="script"><link rel="preload" href="/F2020/assets/js/2.6629548a.js" as="script"><link rel="preload" href="/F2020/assets/js/58.cdf3a991.js" as="script"><link rel="prefetch" href="/F2020/assets/js/10.f0d35086.js"><link rel="prefetch" href="/F2020/assets/js/100.313abe5d.js"><link rel="prefetch" href="/F2020/assets/js/101.e78c32e2.js"><link rel="prefetch" href="/F2020/assets/js/102.d8fed8ad.js"><link rel="prefetch" href="/F2020/assets/js/103.e4ae4182.js"><link rel="prefetch" href="/F2020/assets/js/104.6f57cf87.js"><link rel="prefetch" href="/F2020/assets/js/105.7207033a.js"><link rel="prefetch" href="/F2020/assets/js/106.060e0c00.js"><link rel="prefetch" href="/F2020/assets/js/107.4603fcb0.js"><link rel="prefetch" href="/F2020/assets/js/108.6b4ac7b6.js"><link rel="prefetch" href="/F2020/assets/js/109.9c949bf2.js"><link rel="prefetch" href="/F2020/assets/js/11.f0498a0b.js"><link rel="prefetch" href="/F2020/assets/js/110.da3431d5.js"><link rel="prefetch" href="/F2020/assets/js/111.17da6928.js"><link rel="prefetch" href="/F2020/assets/js/112.c655b676.js"><link rel="prefetch" href="/F2020/assets/js/113.3ca61359.js"><link rel="prefetch" href="/F2020/assets/js/114.9b6101d8.js"><link rel="prefetch" href="/F2020/assets/js/115.2c6c295a.js"><link rel="prefetch" href="/F2020/assets/js/116.596bac3c.js"><link rel="prefetch" href="/F2020/assets/js/117.fb1ee880.js"><link rel="prefetch" href="/F2020/assets/js/118.90d9c781.js"><link rel="prefetch" href="/F2020/assets/js/12.bf72e809.js"><link rel="prefetch" href="/F2020/assets/js/13.958cc2bd.js"><link rel="prefetch" href="/F2020/assets/js/14.3610e7f2.js"><link rel="prefetch" href="/F2020/assets/js/15.d2b91380.js"><link rel="prefetch" href="/F2020/assets/js/16.e49a2ead.js"><link rel="prefetch" href="/F2020/assets/js/17.9f4fb0ae.js"><link rel="prefetch" href="/F2020/assets/js/18.268c075e.js"><link rel="prefetch" href="/F2020/assets/js/19.3cc617b2.js"><link rel="prefetch" href="/F2020/assets/js/20.a95a1241.js"><link rel="prefetch" href="/F2020/assets/js/21.ce4394d8.js"><link rel="prefetch" href="/F2020/assets/js/22.f72eb1b6.js"><link rel="prefetch" href="/F2020/assets/js/23.befff117.js"><link rel="prefetch" href="/F2020/assets/js/24.84dd70d7.js"><link rel="prefetch" href="/F2020/assets/js/25.97d45632.js"><link rel="prefetch" href="/F2020/assets/js/26.276daa11.js"><link rel="prefetch" href="/F2020/assets/js/27.00798bd1.js"><link rel="prefetch" href="/F2020/assets/js/28.e2b98a9f.js"><link rel="prefetch" href="/F2020/assets/js/29.86746147.js"><link rel="prefetch" href="/F2020/assets/js/3.56e1c820.js"><link rel="prefetch" href="/F2020/assets/js/30.e598427d.js"><link rel="prefetch" href="/F2020/assets/js/31.e6743e9b.js"><link rel="prefetch" href="/F2020/assets/js/32.cfa0ffb1.js"><link rel="prefetch" href="/F2020/assets/js/33.02fc8084.js"><link rel="prefetch" href="/F2020/assets/js/34.8d43e2a7.js"><link rel="prefetch" href="/F2020/assets/js/35.c37ee689.js"><link rel="prefetch" href="/F2020/assets/js/36.6785141d.js"><link rel="prefetch" href="/F2020/assets/js/37.a49a3b07.js"><link rel="prefetch" href="/F2020/assets/js/38.11ed7974.js"><link rel="prefetch" href="/F2020/assets/js/39.403bfa1a.js"><link rel="prefetch" href="/F2020/assets/js/4.a6a062fb.js"><link rel="prefetch" href="/F2020/assets/js/40.d357ee1d.js"><link rel="prefetch" href="/F2020/assets/js/41.d6e6fb2f.js"><link rel="prefetch" href="/F2020/assets/js/42.63073b9d.js"><link rel="prefetch" href="/F2020/assets/js/43.e05caa8e.js"><link rel="prefetch" href="/F2020/assets/js/44.b9065ed2.js"><link rel="prefetch" href="/F2020/assets/js/45.f96a24d2.js"><link rel="prefetch" href="/F2020/assets/js/46.063f7ba5.js"><link rel="prefetch" href="/F2020/assets/js/47.c535a809.js"><link rel="prefetch" href="/F2020/assets/js/48.6d67d583.js"><link rel="prefetch" href="/F2020/assets/js/49.ff937964.js"><link rel="prefetch" href="/F2020/assets/js/5.db53b249.js"><link rel="prefetch" href="/F2020/assets/js/50.8d79f6a7.js"><link rel="prefetch" href="/F2020/assets/js/51.44f7e464.js"><link rel="prefetch" href="/F2020/assets/js/52.5db13139.js"><link rel="prefetch" href="/F2020/assets/js/53.114fa10a.js"><link rel="prefetch" href="/F2020/assets/js/54.1157584a.js"><link rel="prefetch" href="/F2020/assets/js/55.b01ba0f7.js"><link rel="prefetch" href="/F2020/assets/js/56.0d589b95.js"><link rel="prefetch" href="/F2020/assets/js/57.30a4771a.js"><link rel="prefetch" href="/F2020/assets/js/59.085e6455.js"><link rel="prefetch" href="/F2020/assets/js/6.1e8126bd.js"><link rel="prefetch" href="/F2020/assets/js/60.030892b0.js"><link rel="prefetch" href="/F2020/assets/js/61.1a07ef59.js"><link rel="prefetch" href="/F2020/assets/js/62.e1d2c18c.js"><link rel="prefetch" href="/F2020/assets/js/63.0ba6e154.js"><link rel="prefetch" href="/F2020/assets/js/64.bf2c3739.js"><link rel="prefetch" href="/F2020/assets/js/65.c810566f.js"><link rel="prefetch" href="/F2020/assets/js/66.67deac8c.js"><link rel="prefetch" href="/F2020/assets/js/67.08be0356.js"><link rel="prefetch" href="/F2020/assets/js/68.e7ea9abe.js"><link rel="prefetch" href="/F2020/assets/js/69.e7a64b97.js"><link rel="prefetch" href="/F2020/assets/js/7.f71a4e05.js"><link rel="prefetch" href="/F2020/assets/js/70.2b5c7b00.js"><link rel="prefetch" href="/F2020/assets/js/71.3a401a88.js"><link rel="prefetch" href="/F2020/assets/js/72.487e85fc.js"><link rel="prefetch" href="/F2020/assets/js/73.07675a6f.js"><link rel="prefetch" href="/F2020/assets/js/74.67a5d3a6.js"><link rel="prefetch" href="/F2020/assets/js/75.e6405f04.js"><link rel="prefetch" href="/F2020/assets/js/76.f303ce9e.js"><link rel="prefetch" href="/F2020/assets/js/77.e7257385.js"><link rel="prefetch" href="/F2020/assets/js/78.54aad2dc.js"><link rel="prefetch" href="/F2020/assets/js/79.62e44747.js"><link rel="prefetch" href="/F2020/assets/js/8.ce844d95.js"><link rel="prefetch" href="/F2020/assets/js/80.c43d0bbb.js"><link rel="prefetch" href="/F2020/assets/js/81.02db2fa9.js"><link rel="prefetch" href="/F2020/assets/js/82.492fb2e4.js"><link rel="prefetch" href="/F2020/assets/js/83.5bfb75e4.js"><link rel="prefetch" href="/F2020/assets/js/84.1c1582ad.js"><link rel="prefetch" href="/F2020/assets/js/85.96857d04.js"><link rel="prefetch" href="/F2020/assets/js/86.7ce62520.js"><link rel="prefetch" href="/F2020/assets/js/87.98824bdd.js"><link rel="prefetch" href="/F2020/assets/js/88.bd2f7ebc.js"><link rel="prefetch" href="/F2020/assets/js/89.652eba80.js"><link rel="prefetch" href="/F2020/assets/js/9.c07e0046.js"><link rel="prefetch" href="/F2020/assets/js/90.5f732538.js"><link rel="prefetch" href="/F2020/assets/js/91.9d7e4794.js"><link rel="prefetch" href="/F2020/assets/js/92.d94a5cb0.js"><link rel="prefetch" href="/F2020/assets/js/93.7a4396ed.js"><link rel="prefetch" href="/F2020/assets/js/94.dc0b7aae.js"><link rel="prefetch" href="/F2020/assets/js/95.3195b17d.js"><link rel="prefetch" href="/F2020/assets/js/96.cb1bda2b.js"><link rel="prefetch" href="/F2020/assets/js/97.a3a1d930.js"><link rel="prefetch" href="/F2020/assets/js/98.5eedb231.js"><link rel="prefetch" href="/F2020/assets/js/99.1fef4ce1.js">
    <link rel="stylesheet" href="/F2020/assets/css/0.styles.a9e3dc67.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/F2020/" class="home-link router-link-active"><!----> <span class="site-name">MAD9137-F2020</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/F2020/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/F2020/assessments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/F2020/modules/week1/" class="nav-link">
  Modules
</a></div><div class="nav-item"><a href="/F2020/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/F2020/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/F2020/assessments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/F2020/modules/week1/" class="nav-link">
  Modules
</a></div><div class="nav-item"><a href="/F2020/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/F2020/modules/week1/" class="sidebar-link">Week 1 Summary</a></li><li><a href="/F2020/modules/week2/" class="sidebar-link">Week 2 Summary</a></li><li><a href="/F2020/modules/week3/" class="sidebar-link">Week 3 Summary</a></li><li><a href="/F2020/modules/week4/" class="sidebar-link">Week 4 Summary</a></li><li><a href="/F2020/modules/week5/" class="sidebar-link">Week 5 Summary</a></li><li><a href="/F2020/modules/week6/" class="sidebar-link">Week 6 Summary</a></li><li><a href="/F2020/modules/week7/" class="sidebar-link">Week 7 Summary</a></li><li><a href="/F2020/modules/week8/" class="sidebar-link">Week 8 Summary</a></li><li><a href="/F2020/modules/week9/" class="sidebar-link">Week 9 Summary</a></li><li><a href="/F2020/modules/week10/" class="sidebar-link">Week 10 Summary</a></li><li><a href="/F2020/modules/week11/" class="sidebar-link">Week 11 Summary</a></li><li><a href="/F2020/modules/week12/" class="sidebar-link">Week 12 Summary</a></li><li><a href="/F2020/modules/week13/" aria-current="page" class="sidebar-link">Week 13 Summary</a></li><li><a href="/F2020/modules/week14/" class="sidebar-link">Week 14 Summary</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-core-location-manager">Using Core Location Manager</h1> <p>In Swift it is possible to get the location of the device using the classes provided within the CoreLocation framework.  To do this you will use a class called CLLocationManager which requires you to implement a few steps to make it work.</p> <p>You must:</p> <ul><li>Add a Privacy description to your info.plist</li> <li>Import the CoreLocation framework into your project</li> <li>Make your viewController class inherit from the CLLocationManagerDelegate</li> <li>Create a CLLocationManager object</li> <li>Set the viewController class as it's delegate, and request authorization to use location services in the app</li> <li>Start updating the location if the user grants authorization</li> <li>Get the location and use the values</li></ul> <p>Additional steps when using the simulator to test:</p> <ul><li>While the alert is being presented to the user, select a location to simulate</li> <li>Then grant access, and get the location.</li></ul> <h2 id="add-a-privacy-descriptor">Add a Privacy Descriptor</h2> <p>First you must add some settings (keys with values) to the Info.plist in your project.  These settings will be used to request permission for your application to access the devices location from the user.  The following keys can be used to request permission from the user, and the values you add for these keys will be the message that the user is asked.</p> <p>Privacy - Location Usage Description</p> <p>Privacy - Location Always Usage Description</p> <p>Privacy - Location When In Use Usage Description</p> <p>Privacy - Location Always and When In Use Usage Description</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The values are your own custom messages that will be displayed to the user when asking permission. (eg. &quot;Do you let this application access this devices location data?&quot;)</p></div> <p>The minimum required key when you are using CoreLocation in your project will be <strong>Privacy - Location When In Use Usage Description</strong>.  You can see an example of this here:</p> <p><img src="/F2020/assets/img/CoreLocation_1.png" alt="LocationManager"></p> <h2 id="import-the-corelocation-framework">Import the CoreLocation Framework</h2> <p>Then at the top of the class that will need to access the geo-location of the device you must add the following import statement:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">// include the CoreLocation framework</span>
<span class="token keyword">import</span> <span class="token builtin">CoreLocation</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="inherit-from-cllocationmanagerdelegate">Inherit From CLLocationManagerDelegate</h2> <p>After this you will need to tell your class to inherit from the <strong>CLLocationManagerDelegate</strong>.  This lets your class have access to the function that will be used to capture the location.</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">// Inherit from the LocationManagerDelegate in this class</span>
<span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">,</span> <span class="token builtin">CLLocationManagerDelegate</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="create-cllocationmanager-object">Create CLLocationManager Object</h2> <p>Then you need to create an object of the type CLLocationManager like so:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">// Create a CLLocationManager object</span>
<span class="token keyword">var</span> myLocationManager <span class="token operator">=</span> <span class="token function">CLLocationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="set-delegate-and-request-authorization">Set Delegate and Request Authorization</h2> <p>This object contains the methods needed to request authorization from the user to access the location and request the current location.  You will most often request authorization in the <code>viewDidLoad()</code> method of your viewController class.  But before you can do this, you must set it's delegate equal to the viewController you are coding in like so:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">// Set the locationManager delegate</span>
myLocationManager<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>

<span class="token comment">// Request authorization from user to access location</span>
myLocationManager<span class="token punctuation">.</span><span class="token function">requestWhenInUseAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>You can choose to instead use myLocationManager.requestAlwaysAuthorization() if your application needs to update the location when it is running in the background.  But you will need the correct security authorization value added to the info.plist to use this.</p></div> <h2 id="start-to-update-the-location">Start to Update the Location</h2> <p>To get the current location you you must tell the manager to start updating the location values <strong>if and only if</strong> the user has granted access.  This is best done in one of the delegate protocol functions like so:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function">locationManager</span><span class="token punctuation">(</span><span class="token number">_</span> manager<span class="token punctuation">:</span> <span class="token builtin">CLLocationManager</span><span class="token punctuation">,</span> didChangeAuthorization status<span class="token punctuation">:</span> <span class="token builtin">CLAuthorizationStatus</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Switch on the state of the authorization to decide what to do.</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token builtin">CLLocationManager</span><span class="token punctuation">.</span><span class="token function">authorizationStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>restricted<span class="token punctuation">,</span> <span class="token punctuation">.</span>notDetermined<span class="token punctuation">,</span> <span class="token punctuation">.</span>denied <span class="token punctuation">:</span>
        <span class="token comment">// If the user has not allowed access stop all updating.</span>
        locationManager<span class="token punctuation">.</span><span class="token function">stopUpdatingLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>authorizedWhenInUse<span class="token punctuation">,</span>  <span class="token punctuation">.</span>authorizedAlways <span class="token punctuation">:</span>
        <span class="token comment">// If the user has allowed access start updating the location of the device.</span>
        locationManager<span class="token punctuation">.</span><span class="token function">startUpdatingLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    @unknown <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token comment">// Manage any future states to be exhaustive.</span>
        locationLabel<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">&quot;ERROR: Unable to access Location Manager&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="get-the-location">Get the Location</h2> <p>Then to get the current location you can access the following values like this:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code> <span class="token comment">// Get the current location values if they are set</span>
<span class="token keyword">if</span> <span class="token keyword">let</span> location <span class="token operator">=</span> locationManager<span class="token punctuation">.</span>location <span class="token punctuation">{</span>
    <span class="token keyword">let</span> newLatitude <span class="token operator">=</span> location<span class="token punctuation">.</span>coordinate<span class="token punctuation">.</span>latitude
    <span class="token keyword">let</span> newLongitude <span class="token operator">=</span> location<span class="token punctuation">.</span>coordinate<span class="token punctuation">.</span>longitude
    <span class="token comment">//Do something with the values</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>Whenever your application is no longer needing the location to be read you must tell the manager to stop updating the location with this function <code>locationManager.stopUpdatingLocation()</code>.  Depending on your application it might be easiest to call this in the function <code>override func viewWillDisappear(_ animated: Bool)</code>.</p></div> <h2 id="testing-in-the-simulator">Testing in the Simulator</h2> <p>When you launch the application for testing in the simulator you will need to make sure you properly start simulating a location.  While the application is running in the simulator you will need to go back into Xcode and find the option at the bottom.</p> <p><img src="/F2020/assets/img/CoreLocation_2.png" alt="LocationManager"></p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>It is best to do this when the alert has popped up asking the user for permission.</p></div> <p>You will be able to choose a location for the list that pops up.</p> <p><img src="/F2020/assets/img/CoreLocation_3.png" alt="LocationManager"></p> <p>Then you can accept the request for permission back in the application.</p> <p><img src="/F2020/assets/img/CoreLocation_4.png" alt="LocationManager"></p> <p>Now when you choose to get the location your application will have permission, and a test location to return the values from.</p> <p><img src="/F2020/assets/img/CoreLocation_5.png" alt="LocationManager"></p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>You can also choose from another list of simulated location in the Simulators top menu by selecting Features-&gt;Location and selecting your choice of <strong>Custom Location</strong>, <strong>City Run</strong>, <strong>City Bicycle Ride</strong>, <strong>Freeway Drive</strong> or <strong>Apple</strong>.  Each one actually simulates a moving device on a predetermined rout that changes over time.</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/9/2020, 6:23:23 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/F2020/assets/js/app.255cbd1a.js" defer></script><script src="/F2020/assets/js/2.6629548a.js" defer></script><script src="/F2020/assets/js/58.cdf3a991.js" defer></script>
  </body>
</html>
